<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruit Match Game</title>
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body id="mainBody">
    <!-- Mode Selection Screen -->
    <div class="mode-selection" id="modeSelection">
        <div class="glass-container" id="modeContainer">
            <h1><span class="material-icons-outlined md-48">sports_esports</span> Fruit Match</h1>
            <p class="subtitle">Choose Your Game Mode</p>
            
            <div class="settings-row">
                <div class="audio-controls-menu">
                    <button id="musicToggleMenu" class="glass-btn ripple" title="Toggle Music">
                        <span class="material-icons-outlined">music_note</span>
                        <span>Music</span>
                    </button>
                    <button id="sfxToggleMenu" class="glass-btn ripple" title="Toggle Sound Effects">
                        <span class="material-icons-outlined">volume_up</span>
                        <span>Effects</span>
                    </button>
                </div>
                
                <button id="bgSettingsBtn" class="glass-btn ripple" onclick="openBackgroundSettings()">
                    <span class="material-icons-outlined">palette</span>
                    <span>Theme</span>
                </button>
            </div>
            
            <div class="mode-cards">
                <div class="glass-card ripple" onclick="selectMode('level')">
                    <span class="material-icons-outlined mode-icon">flag</span>
                    <h2>Level Mode</h2>
                    <p>Progress through challenging levels with limited moves</p>
                    <div class="mode-stats">
                        <span class="material-icons-outlined">emoji_events</span>
                        <span>Level <strong id="currentLevelDisplay">1</strong></span>
                    </div>
                </div>
                
                <div class="glass-card ripple" onclick="selectMode('infinite')">
                    <span class="material-icons-outlined mode-icon">all_inclusive</span>
                    <h2>Infinite Mode</h2>
                    <p>Play endlessly and beat your high score</p>
                    <div class="mode-stats">
                        <span class="material-icons-outlined">star</span>
                        <span>Best <strong id="highScoreDisplay">0</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="game-container glass-container" id="gameContainer" style="display: none;">
        <div class="game-header">
            <button class="glass-btn ripple" onclick="backToMenu()">
                <span class="material-icons-outlined">arrow_back</span>
                <span>Menu</span>
            </button>
            <h1 id="gameTitle"><span class="material-icons-outlined">sports_esports</span> Fruit Match</h1>
        </div>
        
        <div class="score-board glass-surface">
            <div class="score-item">
                <span class="material-icons-outlined score-icon">analytics</span>
                <div class="score-label">Score</div>
                <div class="score-value" id="score">0</div>
            </div>
            <div class="score-item" id="movesContainer">
                <span class="material-icons-outlined score-icon">touch_app</span>
                <div class="score-label">Moves</div>
                <div class="score-value" id="moves">20</div>
            </div>
            <div class="score-item" id="levelContainer" style="display: none;">
                <span class="material-icons-outlined score-icon">layers</span>
                <div class="score-label">Level</div>
                <div class="score-value" id="level">1</div>
            </div>
            <div class="score-item" id="targetContainer" style="display: none;">
                <span class="material-icons-outlined score-icon">flag</span>
                <div class="score-label">Target</div>
                <div class="score-value" id="target">500</div>
            </div>
            <div class="score-item" id="highScoreContainer" style="display: none;">
                <span class="material-icons-outlined score-icon">emoji_events</span>
                <div class="score-label">Best</div>
                <div class="score-value" id="highScore">0</div>
            </div>
        </div>

        <div class="audio-controls">
            <button id="musicToggle" class="glass-btn ripple" title="Toggle Music">
                <span class="material-icons-outlined icon">music_note</span>
                <span class="label">Music</span>
            </button>
            <button id="sfxToggle" class="glass-btn ripple" title="Toggle Sound Effects">
                <span class="material-icons-outlined icon">volume_up</span>
                <span class="label">Effects</span>
            </button>
        </div>

        <div class="game-board glass-surface" id="gameBoard"></div>

        <div class="buttons">
            <button class="glass-btn ripple" onclick="resetGame()">
                <span class="material-icons-outlined">refresh</span>
                <span>Restart</span>
            </button>
            <button class="glass-btn ripple" onclick="shuffle()">
                <span class="material-icons-outlined">shuffle</span>
                <span>Shuffle</span>
            </button>
        </div>

        <div class="message" id="message">
            <span class="material-icons-outlined">swipe</span> Swipe to match fruits!
        </div>
    </div>

    <!-- Background Settings Modal -->
    <div class="modal" id="backgroundModal">
        <div class="modal-overlay" onclick="closeBackgroundSettings()"></div>
        <div class="modal-content glass-container">
            <div class="modal-header">
                <h2><span class="material-icons-outlined">palette</span> Theme Settings</h2>
                <button class="close-btn ripple" onclick="closeBackgroundSettings()">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- Default Themes Tab -->
                <div class="theme-section active" id="defaultThemesSection">
                    <h3><span class="material-icons-outlined">color_lens</span> Default Themes</h3>
                    <div class="theme-grid">
                        <div class="theme-option glass-card ripple" onclick="selectBackground('default1')">
                            <div class="theme-preview bg-default1"></div>
                            <p>Purple Dream</p>
                        </div>
                        <div class="theme-option glass-card ripple" onclick="selectBackground('default2')">
                            <div class="theme-preview bg-default2"></div>
                            <p>Sunset Glow</p>
                        </div>
                        <div class="theme-option glass-card ripple" onclick="selectBackground('default3')">
                            <div class="theme-preview bg-default3"></div>
                            <p>Ocean Blue</p>
                        </div>
                        <div class="theme-option glass-card ripple" onclick="selectBackground('default4')">
                            <div class="theme-preview bg-default4"></div>
                            <p>Forest Green</p>
                        </div>
                        <div class="theme-option glass-card ripple" onclick="selectBackground('default5')">
                            <div class="theme-preview bg-default5"></div>
                            <p>AMOLED Dark</p>
                        </div>
                    </div>
                </div>

                <!-- Custom Background Tab -->
                <div class="theme-section">
                    <h3><span class="material-icons-outlined">add_photo_alternate</span> Custom Wallpaper</h3>
                    <button class="upload-trigger-btn glass-btn ripple" onclick="openCustomBackgroundUpload()">
                        <span class="material-icons-outlined">upload</span>
                        <span>Upload Custom Image</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Background Upload Modal -->
    <div class="modal" id="customUploadModal">
        <div class="modal-overlay" onclick="closeCustomUpload()"></div>
        <div class="modal-content glass-container custom-upload-modal">
            <div class="modal-header">
                <h2><span class="material-icons-outlined">image</span> Custom Wallpaper</h2>
                <button class="close-btn ripple" onclick="closeCustomUpload()">
                    <span class="material-icons-outlined">close</span>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="customBgInput" accept="image/*" style="display: none;">
                    <div class="upload-placeholder" onclick="document.getElementById('customBgInput').click()">
                        <span class="material-icons-outlined upload-icon">add_photo_alternate</span>
                        <p>Tap to select image</p>
                        <span class="upload-hint">Supports up to 4K resolution</span>
                    </div>
                </div>

                <!-- Preview and Color Palette -->
                <div id="imagePreviewSection" class="image-preview-section" style="display: none;">
                    <div class="preview-image-container">
                        <img id="previewImage" alt="Preview">
                    </div>
                    
                    <div class="color-palette-wrapper glass-surface">
                        <h4><span class="material-icons-outlined tiny">palette</span> Tap a color to set theme</h4>
                        <div id="colorPaletteGrid" class="color-palette-grid"></div>
                    </div>

                    <div class="upload-actions">
                        <button class="glass-btn ripple apply-wallpaper-btn" onclick="applyCustomWallpaper()">
                            <span class="material-icons-outlined">check</span>
                            <span>Apply Wallpaper</span>
                        </button>
                        <button class="glass-btn ripple remove-wallpaper-btn" onclick="removeCustomWallpaper()">
                            <span class="material-icons-outlined">delete</span>
                            <span>Remove</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Level Complete Modal -->
    <div class="modal" id="levelCompleteModal">
        <div class="modal-overlay"></div>
        <div class="modal-content glass-container celebration-modal">
            <span class="material-icons-outlined celebration-icon">emoji_events</span>
            <h2>Level Complete!</h2>
            <p class="modal-score">Score: <span id="modalScore">0</span></p>
            <p class="modal-level">Level <span id="modalLevel">1</span> Completed</p>
            <button class="glass-btn ripple full-width" onclick="nextLevel()">
                <span>Next Level</span>
                <span class="material-icons-outlined">arrow_forward</span>
            </button>
            <button class="glass-btn ripple secondary full-width" onclick="backToMenu()">Menu</button>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div class="modal" id="gameOverModal">
        <div class="modal-overlay"></div>
        <div class="modal-content glass-container">
            <span class="material-icons-outlined gameover-icon">sentiment_dissatisfied</span>
            <h2>Game Over</h2>
            <p class="modal-score">Final Score: <span id="finalScore">0</span></p>
            <p class="modal-message" id="gameOverMessage"></p>
            <button class="glass-btn ripple full-width" onclick="resetGame()">Try Again</button>
            <button class="glass-btn ripple secondary full-width" onclick="backToMenu()">Menu</button>
        </div>
    </div>

    <!-- Hidden audio elements -->
    <audio id="popSound" preload="auto">
        <source src="pop.mp3" type="audio/mpeg">
    </audio>

    <audio id="backgroundMusic" loop preload="auto">
        <source src="background-music.mp3" type="audio/mpeg">
    </audio>

    <script src="script.js"></script>
</body>
</html>